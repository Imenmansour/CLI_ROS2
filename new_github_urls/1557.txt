skip to content you signed in with another tab or window. reload to refresh your session. you signed out in another tab or window. reload to refresh your session. you switched accounts on another tab or window. reload to refresh your session. dismiss alert ros2 / rosbag2 public notifications you must be signed in to change notification settings fork 244 star 272 new issue have a question  this project?  for a free github account to open an issue and  its maintainers and the community.  for github by clicking  for github, you agree to our  of service and  statement . well occasionally send you account related s. already on github?  to your account jump to bottom gracefully handle sigint and sigterm signals for play and burst cli #1557 merged michaelorlov merged 5 commits into rolling from morlov/gracefully_handle_signals_in_player apr 11, 2024 merged gracefully handle sigint and sigterm signals for play and burst cli #1557 michaelorlov merged 5 commits into rolling from morlov/gracefully_handle_signals_in_player apr 11, 2024 conversation copy link contributor michaelorlov commented jan 31, 2024  edited loading depends from fix for false negative tests in rosbag2_py #1592 intercept signals to call player::stop() instead of relying on the rclcpp::shutdown() in default signal handlers. also added static player::cancel() method. added test coverage for cancel during playback. note: adding unit test coverage for cancel during burst is not feasible because it runs very fast without delays between messages and without a repetition option. sorry, something went wrong. all reactions michaelorlov force-pushed the morlov/gracefully_handle_signals_in_player branch 3 times, most recently from fd111a4 to 9c71281 compare march 19, 2024 19:06 michaelorlov marked this pull request as ready for review march 19, 2024 19:11 michaelorlov requested a review from a team as a code owner march 19, 2024 19:11 michaelorlov requested review from emersonknapp and hidmic and removed request for a team march 19, 2024 19:11 michaelorlov changed the title [wip] gracefully handle sigint and sigterm signals for play and burst cli gracefully handle sigint and sigterm signals for play and burst cli mar 19, 2024 michaelorlov self-assigned this mar 19, 2024 michaelorlov requested a review from fujitatomoya march 19, 2024 19:14 michaelorlov force-pushed the morlov/gracefully_handle_signals_in_player branch from 9c71281 to 1e168a1 compare march 21, 2024 16:04 copy link contributor author michaelorlov commented mar 21, 2024 @fujitatomoya @r7vme @sangteak601 i would use a review for this pr. all reactions sorry, something went wrong. copy link sangteak601 commented mar 22, 2024 looks good to me. all reactions sorry, something went wrong. copy link ros-discourse commented mar 26, 2024 this pull request has been mentioned on ros discourse . there might be relevant details there: https://discourse.ros.org/t/ros-2-tsc-meeting-minutes-for-2024-03-21/36814/1 all reactions sorry, something went wrong. copy link contributor author michaelorlov commented mar 26, 2024 gist: https://gist.githubusercontent.com/michaelorlov/6988fe3cba817e9ea4882a6957d37d28/raw/73ff5df4c6165b9d480abd7caeff0fbb350484b4/ros2.repos build args: --packages-above-and-dependencies rosbag2_py rosbag2_transport rosbag2_tests test args: --packages-above rosbag2_py rosbag2_transport rosbag2_tests ros distro: rolling job: ci_launcher ci_launcher ran: https://ci.ros2.org/job/ci_launcher/13536 linux linux-aarch64 windows all reactions sorry, something went wrong. copy link contributor fujitatomoya commented mar 26, 2024 @michaelorlov i can review this tomorrow.  1 michaelorlov reacted with thumbs up emoji all reactions  1 reaction sorry, something went wrong. fujitatomoya reviewed mar 26, 2024 view reviewed changes copy link contributor fujitatomoya left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment @michaelorlov one thing i want to confirm, probably that can be intention but i really do not see the reason, why it does not call the original signal handler from user application. sorry, something went wrong. all reactions rosbag2_py/src/rosbag2_py/_transport.cpp outdated show resolved hide resolved fujitatomoya approved these changes mar 27, 2024 view reviewed changes copy link contributor fujitatomoya left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment lgtm sorry, something went wrong. all reactions copy link contributor author michaelorlov commented mar 28, 2024 @clalancette i will need your formal approval or additional review for this pr. all reactions sorry, something went wrong. fujitatomoya reviewed mar 29, 2024 view reviewed changes copy link contributor fujitatomoya left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment @michaelorlov thanks for the fix, i had a couple of minor comments. sorry, something went wrong. all reactions rosbag2_py/src/rosbag2_py/_transport.cpp show resolved hide resolved rosbag2_py/src/rosbag2_py/_transport.cpp show resolved hide resolved copy link contributor author michaelorlov commented apr 10, 2024 @clalancette @emersonknapp i need a formal review/approval for this pr. @fujitatomoya doesn't have write permissions to the rosbag2 repository and i can't merge with only his approaval. if you will approve this pr i will re-run ci and if it is green will merge it. all reactions sorry, something went wrong. emersonknapp approved these changes apr 10, 2024 view reviewed changes clalancette approved these changes apr 10, 2024 view reviewed changes copy link contributor author michaelorlov commented apr 10, 2024 gist: https://gist.githubusercontent.com/michaelorlov/82537b0fd13a1c970b1dc96f41168b65/raw/35835c4132ebe7f1094443d2366e3a27aabaaf48/ros2.repos build args: --packages-above-and-dependencies rosbag2_py rosbag2_transport rosbag2_tests test args: --packages-above rosbag2_py rosbag2_transport rosbag2_tests ros distro: rolling job: ci_launcher ci_launcher ran: https://ci.ros2.org/job/ci_launcher/13670 linux linux-aarch64 windows all reactions sorry, something went wrong. michaelorlov added 5 commits april 10, 2024 17:47 gracefully handle sigint and sigterm signals for play and burst cli  ef71766 - intercept signals to call player::stop() instead of relying on the rclcpp::shutdown() in default signal handlers. - also added static player::cancel() method. signed-off-by: michael orlov <michael.orlov@apex.ai> add test_play_cancel to the test_transport.py  521d0e5 signed-off-by: michael orlov <michael.orlov@apex.ai> add missing imports in test_transport.py  e00804a signed-off-by: michael orlov <michael.orlov@apex.ai> regenerate python stub files (.pyi) after altering api  9cc6eef signed-off-by: michael orlov <michael.orlov@apex.ai> add call for original deferred signal handler for player and recorder  28311ed signed-off-by: michael orlov <michael.orlov@apex.ai> michaelorlov force-pushed the morlov/gracefully_handle_signals_in_player branch from 2909332 to 28311ed compare april 11, 2024 00:48 copy link contributor author michaelorlov commented apr 11, 2024 did rebase before merge to see if rpr and build_test jobs will pass. all reactions sorry, something went wrong. copy link contributor author michaelorlov commented apr 11, 2024 rpr job failed with flake8 errors in unrelated packages. it seems a known issue on the ci and unrelated to this pr. merging then. all reactions sorry, something went wrong. hide details view details michaelorlov merged commit 32bd5c3 into rolling apr 11, 2024 13 of 14 checks passed delete-merged-branch bot deleted the morlov/gracefully_handle_signals_in_player branch april 11, 2024 01:57 copy link contributor author michaelorlov commented jun 4, 2024 https://github.com/mergifyio backport iron humble  1 mergify[bot] reacted with thumbs up emoji all reactions  1 reaction sorry, something went wrong. copy link mergify bot commented jun 4, 2024  edited loading backport iron humble  backports have been created #1690 gracefully handle sigint and sigterm signals for play and burst cli (backport #1557) has been created for branch iron but encountered conflicts #1691 gracefully handle sigint and sigterm signals for play and burst cli (backport #1557) has been created for branch humble but encountered conflicts all reactions sorry, something went wrong. mergify bot pushed a commit that referenced this pull request jun 4, 2024 gracefully handle sigint and sigterm signals for play and burst cli ( #  9b7eb21 1557 ) * gracefully handle sigint and sigterm signals for play and burst cli - intercept signals to call player::stop() instead of relying on the rclcpp::shutdown() in default signal handlers. - also added static player::cancel() method. signed-off-by: michael orlov <michael.orlov@apex.ai> * add test_play_cancel to the test_transport.py signed-off-by: michael orlov <michael.orlov@apex.ai> * add missing imports in test_transport.py signed-off-by: michael orlov <michael.orlov@apex.ai> * regenerate python stub files (.pyi) after altering api signed-off-by: michael orlov <michael.orlov@apex.ai> * add call for original deferred signal handler for player and recorder signed-off-by: michael orlov <michael.orlov@apex.ai> --------- signed-off-by: michael orlov <michael.orlov@apex.ai> (cherry picked from commit 32bd5c3 ) # conflicts: # rosbag2_py/rosbag2_py/_transport.pyi # rosbag2_py/src/rosbag2_py/_transport.cpp # rosbag2_transport/src/rosbag2_transport/player.cpp mergify bot mentioned this pull request jun 4, 2024 [iron] gracefully handle sigint and sigterm signals for play and burst cli (backport #1557) #1690 merged mergify bot pushed a commit that referenced this pull request jun 4, 2024 gracefully handle sigint and sigterm signals for play and burst cli ( #  5ff8f94 1557 ) * gracefully handle sigint and sigterm signals for play and burst cli - intercept signals to call player::stop() instead of relying on the rclcpp::shutdown() in default signal handlers. - also added static player::cancel() method. signed-off-by: michael orlov <michael.orlov@apex.ai> * add test_play_cancel to the test_transport.py signed-off-by: michael orlov <michael.orlov@apex.ai> * add missing imports in test_transport.py signed-off-by: michael orlov <michael.orlov@apex.ai> * regenerate python stub files (.pyi) after altering api signed-off-by: michael orlov <michael.orlov@apex.ai> * add call for original deferred signal handler for player and recorder signed-off-by: michael orlov <michael.orlov@apex.ai> --------- signed-off-by: michael orlov <michael.orlov@apex.ai> (cherry picked from commit 32bd5c3 ) # conflicts: # rosbag2_py/rosbag2_py/_transport.pyi # rosbag2_py/src/rosbag2_py/_transport.cpp # rosbag2_py/test/test_transport.py # rosbag2_transport/src/rosbag2_transport/player.cpp mergify bot mentioned this pull request jun 4, 2024 [humble] gracefully handle sigint and sigterm signals for play and burst cli (backport #1557) #1691 closed michaelorlov added a commit that referenced this pull request jun 6, 2024 [iron] gracefully handle sigint and sigterm signals for play and burs  fd22add t cli (backport #1557 ) ( #1690 ) * gracefully handle sigint and sigterm signals for play and burst cli ( #1557 ) * gracefully handle sigint and sigterm signals for play and burst cli - intercept signals to call player::stop() instead of relying on the rclcpp::shutdown() in default signal handlers. - also added static player::cancel() method. signed-off-by: michael orlov <michael.orlov@apex.ai> * add test_play_cancel to the test_transport.py signed-off-by: michael orlov <michael.orlov@apex.ai> * add missing imports in test_transport.py signed-off-by: michael orlov <michael.orlov@apex.ai> * regenerate python stub files (.pyi) after altering api signed-off-by: michael orlov <michael.orlov@apex.ai> * add call for original deferred signal handler for player and recorder signed-off-by: michael orlov <michael.orlov@apex.ai> --------- signed-off-by: michael orlov <michael.orlov@apex.ai> (cherry picked from commit 32bd5c3 ) # conflicts: # rosbag2_py/rosbag2_py/_transport.pyi # rosbag2_py/src/rosbag2_py/_transport.cpp # rosbag2_transport/src/rosbag2_transport/player.cpp * address merge conflicts signed-off-by: michael orlov <michael.orlov@apex.ai> --------- signed-off-by: michael orlov <michael.orlov@apex.ai> co-authored-by: michael orlov <michael.orlov@apex.ai>  for free to join this conversation on github . already have an account?  to comment reviewers fujitatomoya fujitatomoya approved these changes clalancette clalancette approved these changes emersonknapp emersonknapp approved these changes hidmic awaiting requested review from hidmic hidmic is a code owner automatically assigned from ros2/tooling-reviewers assignees michaelorlov labels none yet projects none yet milestone no milestone development successfully merging this pull request may close these issues. 6 participants add this suggestion to a batch that can be applied as a single commit. this suggestion is invalid because no changes were made to the code. suggestions cannot be applied while the pull request is closed. suggestions cannot be applied while viewing a subset of changes. only one suggestion per line can be applied in a batch. add this suggestion to a batch that can be applied as a single commit. applying suggestions on deleted lines is not supported. you must change the existing code in this line in order to create a valid suggestion. outdated suggestions cannot be applied. this suggestion has been applied or marked resolved. suggestions cannot be applied from pending reviews. suggestions cannot be applied on multi-line comments. suggestions cannot be applied while the pull request is queued to merge. suggestion cannot be applied right now.  check back later. you cant perform that action at this time.