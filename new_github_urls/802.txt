skip to content you signed in with another tab or window. reload to refresh your session. you signed out in another tab or window. reload to refresh your session. you switched accounts on another tab or window. reload to refresh your session. dismiss alert ros2 / ros2cli public notifications you must be signed in to change notification settings fork 161 star 173 new issue have a question  this project?  for a free github account to open an issue and  its maintainers and the community.  for github by clicking  for github, you agree to our  of service and  statement . well occasionally send you account related s. already on github?  to your account jump to bottom add timeout option for ros2param to find node. #802 merged fujitatomoya merged 3 commits into rolling from fujitatomoya/20230207-ros2param-timeout feb 24, 2023 merged add timeout option for ros2param to find node. #802 fujitatomoya merged 3 commits into rolling from fujitatomoya/20230207-ros2param-timeout feb 24, 2023 conversation copy link collaborator fujitatomoya commented feb 8, 2023 address #799 signed-off-by: tomoya fujita tomoya.fujita@sony.com sorry, something went wrong. all reactions add timeout option for ros2param to find node.  ec96682 signed-off-by: tomoya fujita <tomoya.fujita@sony.com> fujitatomoya requested review from audrow and gbiggs as code owners february 8, 2023 05:10 copy link collaborator author fujitatomoya commented feb 8, 2023 @audrow @gbiggs what do you think? i will add timeout option to other ros2 param sub-command as well. all reactions sorry, something went wrong. fujitatomoya mentioned this pull request feb 8, 2023 check for existence of node in verbs can cause false failures when calling #799 closed fujitatomoya commented feb 8, 2023 view reviewed changes ros2param/test/test_verb_load.py show resolved hide resolved copy link collaborator author fujitatomoya commented feb 8, 2023 @iuhilnehc-ynos it would be helpful if you can review. all reactions sorry, something went wrong. iuhilnehc-ynos reviewed feb 8, 2023 view reviewed changes copy link iuhilnehc-ynos left a comment  edited loading there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment can we just use ros2cli/ros2cli/ros2cli/helpers.py line 25 in 1e3f1a0 def wait_for ( predicate , timeout , period = 0.1 ): instead of adding wait_for_node ? and then use it similar to ros2cli/ros2cli/ros2cli/daemon/daemonize.py lines 141 to 147 in 1e3f1a0 def daemon_ready (): try : pickler . dump ( none ) return false except oserror : return true if not wait_for ( daemon_ready , timeout ): . just a tiny minor suggestion. sorry, something went wrong. all reactions copy link iuhilnehc-ynos commented feb 8, 2023  edited loading if the wait_for_node is a helper code that will be used in somewhere else, what  using wait_for in the wait_for_node ? def wait_for_node ( node , node_name , include_hidden_nodes = false , timeout = 1.0 ) -> bool : def check_node_names (): node_names = get_node_names ( node = node , include_hidden_nodes = include_hidden_nodes ) return true if node_name in { n . full_name for n in node_names } else false return wait_for ( check_node_names , timeout ) all reactions sorry, something went wrong. copy link iuhilnehc-ynos commented feb 8, 2023  edited loading btw: ros2cli/ros2cli/ros2cli/helpers.py lines 40 to 44 in 1e3f1a0 while not predicate (): if time . time () > deadline : break time . sleep ( period ) return predicate () should be updated, because the predicate() is unnecessary to be called twice under some situations. (it reminded me of the logic similar to https://github.com/gcc-mirror/gcc/blob/83ffe9cde7fe0b4deb0d1b54175fd9b19c38179c/libstdc%2b%2b-v3/include/std/condition_variable#l348-l351 .) while not predicate (): if time . time () > deadline : return predicate () time . sleep ( period ) return true  1 fujitatomoya reacted with thumbs up emoji all reactions  1 reaction sorry, something went wrong. take advantage of wait_for method to avoid redundant code.  776312d signed-off-by: tomoya fujita <tomoya.fujita@sony.com> copy link collaborator author fujitatomoya commented feb 8, 2023 @iuhilnehc-ynos thanks for the suggested fix, all addressed in 776312d all reactions sorry, something went wrong. copy link collaborator author fujitatomoya commented feb 8, 2023 i believe that same option can be applied at lease ros2param sub command, since other sub commands have possibly same problem. all reactions sorry, something went wrong. add timeout option for ros2param subcommands.  c1aab6b signed-off-by: tomoya fujita <tomoya.fujita@sony.com> fujitatomoya commented feb 8, 2023 view reviewed changes ros2param/test/test_verb_load.py show resolved hide resolved iuhilnehc-ynos approved these changes feb 9, 2023 view reviewed changes copy link collaborator author fujitatomoya commented feb 9, 2023 ci: linux linux-aarch64 windows all reactions sorry, something went wrong. copy link collaborator author fujitatomoya commented feb 10, 2023 linux-aarch64 all reactions sorry, something went wrong. copy link collaborator author fujitatomoya commented feb 10, 2023 @audrow @gbiggs friendly ping, requesting another review. all reactions sorry, something went wrong. destogl approved these changes feb 13, 2023 view reviewed changes copy link destogl left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment thanks for following up on this! i have just a small proposal to increase the default timeout. as you see in the tests, 1, second could be too low. sorry, something went wrong. all reactions ros2param/ros2param/verb/describe.py show resolved hide resolved audrow approved these changes feb 13, 2023 view reviewed changes copy link member audrow left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment looks good to me - thanks, @fujitatomoya ! sorry, something went wrong. all reactions copy link collaborator author fujitatomoya commented feb 24, 2023 @audrow thanks for the review, i will go ahead to merge this. all reactions sorry, something went wrong. fujitatomoya merged commit f31cd91 into rolling feb 24, 2023 delete-merged-branch bot deleted the fujitatomoya/20230207-ros2param-timeout branch february 24, 2023 21:47 tokoro10g mentioned this pull request sep 26, 2023 backport timeout options on humble #855 open  for free to join this conversation on github . already have an account?  to comment reviewers destogl destogl approved these changes audrow audrow approved these changes iuhilnehc-ynos iuhilnehc-ynos approved these changes gbiggs awaiting requested review from gbiggs gbiggs is a code owner assignees no one assigned labels none yet projects none yet milestone no milestone development successfully merging this pull request may close these issues. 4 participants add this suggestion to a batch that can be applied as a single commit. this suggestion is invalid because no changes were made to the code. suggestions cannot be applied while the pull request is closed. suggestions cannot be applied while viewing a subset of changes. only one suggestion per line can be applied in a batch. add this suggestion to a batch that can be applied as a single commit. applying suggestions on deleted lines is not supported. you must change the existing code in this line in order to create a valid suggestion. outdated suggestions cannot be applied. this suggestion has been applied or marked resolved. suggestions cannot be applied from pending reviews. suggestions cannot be applied on multi-line comments. suggestions cannot be applied while the pull request is queued to merge. suggestion cannot be applied right now.  check back later. you cant perform that action at this time.