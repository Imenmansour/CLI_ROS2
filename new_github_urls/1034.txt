skip to content you signed in with another tab or window. reload to refresh your session. you signed out in another tab or window. reload to refresh your session. you switched accounts on another tab or window. reload to refresh your session. dismiss alert ros2 / rosbag2 public notifications you must be signed in to change notification settings fork 244 star 272 new issue have a question  this project?  for a free github account to open an issue and  its maintainers and the community.  for github by clicking  for github, you agree to our  of service and  statement . well occasionally send you account related s. already on github?  to your account jump to bottom added support for filtering topics via regular expressions #1034 merged michaelorlov merged 4 commits into ros2 : rolling from esteve : filter-regex jul 5, 2022 merged added support for filtering topics via regular expressions #1034 michaelorlov merged 4 commits into ros2 : rolling from esteve : filter-regex jul 5, 2022 conversation copy link member esteve commented jun 28, 2022 this pr adds a new option --topics-regex that allows filtering topics via regular expressions. sorry, something went wrong.  1 kenji-miyake reacted with thumbs up emoji all reactions  1 reaction esteve force-pushed the filter-regex branch 5 times, most recently from bc3e1a2 to fd879f7 compare june 28, 2022 14:15 audrow changed the base branch from master to rolling june 28, 2022 14:50 esteve force-pushed the filter-regex branch from fd879f7 to 1e804ae compare june 29, 2022 14:55 copy link member author esteve commented jun 29, 2022 i'm debugging an issue with the player and regular expressions. the following causes ros2 bag play to throw an exception:  ros2 bag play . --topics-regex /lidar_front/points_raw [info] [1656517413.919186963] [rosbag2_storage]: opened database ' ./rosbag2_2020_09_23-15_58_07.db3 ' for read_only. [info] [1656517413.919316194] [rosbag2_player]: set rate to 1 [info] [1656517413.925218047] [rosbag2_player]: adding keyboard callbacks. [info] [1656517413.925259647] [rosbag2_player]: press space for pause/resume [info] [1656517413.925286814] [rosbag2_player]: press cursor_right for play next message [info] [1656517413.925312879] [rosbag2_player]: press cursor_up for increase rate 10% [info] [1656517413.925341094] [rosbag2_player]: press cursor_down for decrease rate 10% [info] [1656517413.925446615] [rosbag2_player]: playback until timestamp: -1 [info] [1656517413.925790959] [rosbag2_storage]: opened database ' ./rosbag2_2020_09_23-15_58_07.db3 ' for read_only. [error] [1656517414.026479569] [rosbag2_player]: failed to play: error when preparing sql statement ' select data, timestamp, topics.name, messages.id from messages join topics on messages.topic_id = topics.id where ((topics.name regexp ' /lidar_front/points_raw ' )) and (((timestamp = 1600901887524769241) and (messages.id >= 0)) or (timestamp > 1600901887524769241)) order by messages.timestamp, messages.id; ' . sqlite error: (1): sql logic error however, when issuing that same query directly via the sqlite3 command line interface, i get the correct results. all reactions sorry, something went wrong. copy link member author esteve commented jun 29, 2022 it seems that for the regexp operator to work an application-defined function needs to be provided. i'm guessing that the sqlite3 command line tool already includes one, so in this case it'd be a matter of defining one in the c++ code. all reactions sorry, something went wrong. esteve marked this pull request as ready for review june 30, 2022 10:06 esteve requested a review from a team as a code owner june 30, 2022 10:06 esteve requested review from emersonknapp and jhdcs and removed request for a team june 30, 2022 10:06 copy link member author esteve commented jun 30, 2022 this now works, you can pass multiple arguments to --topics-regex and ros2 bag play will only play the topics that match the regular expressions (e.g. --topics-regex /lidar_.*/points_raw ) all reactions sorry, something went wrong. jhdcs approved these changes jun 30, 2022 view reviewed changes copy link contributor jhdcs left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment this looks okay to me, though i wouldn't mind a second opinion from another reviewer. sorry, something went wrong. all reactions michaelorlov self-requested a review july 1, 2022 07:15 copy link contributor michaelorlov commented jul 1, 2022 this looks okay to me, though i wouldn't mind a second opinion from another reviewer. i will review it in a couple days. all reactions sorry, something went wrong. michaelorlov requested changes jul 3, 2022 view reviewed changes copy link contributor michaelorlov left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment @esteve overall looks good to me. among one nitpick with pointers initialization. also could you  write a few unit tests to cover new topics_regex api ? sorry, something went wrong. all reactions rosbag2_storage_default_plugins/src/rosbag2_storage_default_plugins/sqlite/sqlite_wrapper.cpp outdated show resolved hide resolved copy link member author esteve commented jul 5, 2022 @michaelorlov i've added a test based on the the existing topics api, does it look enough or would you like more tests? thanks. all reactions sorry, something went wrong. esteve and others added 4 commits july 5, 2022 16:00 added support for filtering topics via regular expressions  f51c62c signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> added application function for evaluating regular expressions from wi  1d4ba30 thin sqlite3 signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> use nullptr for null pointers  ee5d40e signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> added tests for topics-regex api  992e573 signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> esteve force-pushed the filter-regex branch from b0f6434 to 992e573 compare july 5, 2022 14:00 michaelorlov approved these changes jul 5, 2022 view reviewed changes copy link contributor michaelorlov left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment @esteve  for your contribution! now it looks good. approving. sorry, something went wrong. all reactions copy link contributor michaelorlov commented jul 5, 2022  edited loading running ci: gist: https://gist.githubusercontent.com/michaelorlov/4902ef223bb586d0f7311fd7508bc496/raw/28022ca5ed769da33c9731136f0d03173f8dec13/ros2.repos build args: --packages-above-and-dependencies ros2bag rosbag2_py rosbag2_storage rosbag2_storage_default_plugins rosbag2_transport rosbag2_tests test args: --packages-above ros2bag rosbag2_py rosbag2_storage rosbag2_storage_default_plugins rosbag2_transport rosbag2_tests ros distro: rolling job: ci_launcher ci_launcher ran: https://ci.ros2.org/job/ci_launcher/10473 linux linux-aarch64 windows all reactions sorry, something went wrong. michaelorlov merged commit 3f1bf5f into ros2 : rolling jul 5, 2022 esteve added a commit to esteve/rosbag2 that referenced this pull request jul 6, 2022 added support for filtering topics via regular expressions ( ros2#1034 )  2f15b24 * added support for filtering topics via regular expressions signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * added application function for evaluating regular expressions from within sqlite3 signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * use nullptr for null pointers signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * added tests for topics-regex api signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> esteve mentioned this pull request jul 6, 2022 [humble] backport. added support for filtering topics via regular expressions (#1034)- #1039 merged esteve deleted the filter-regex branch july 6, 2022 15:56 michaelorlov pushed a commit that referenced this pull request jul 28, 2022 [humble] backport. added support for filtering topics via regular exp  193caee ressions ( #1034 )- ( #1039 ) * added support for filtering topics via regular expressions ( #1034 ) * added support for filtering topics via regular expressions signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * added application function for evaluating regular expressions from within sqlite3 signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * use nullptr for null pointers signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * added tests for topics-regex api signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> * renamed --topics-regex to --regex and -e signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> esteve added a commit that referenced this pull request aug 16, 2022 revert "[humble] backport. added support for filtering topics via reg  3ae4bf9 ular expressions ( #1034 )- ( #1039 )" this reverts commit 193caee . esteve added a commit that referenced this pull request aug 16, 2022 revert "[humble] backport. added support for filtering topics via reg  8e34960 ular expressions ( #1034 )- ( #1039 )" this reverts commit 193caee . signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> michaelorlov pushed a commit that referenced this pull request aug 17, 2022 revert "[humble] backport. added support for filtering topics via reg  2579e9f ular expressions ( #1034 )- ( #1039 )" ( #1069 ) this reverts commit 193caee . signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> signed-off-by: esteve fernandez <esteve.fernandez@tier4.jp> copy link ros-discourse commented aug 23, 2022 this pull request has been mentioned on ros discourse . there might be relevant details there: https://discourse.ros.org/t/ros-2-tsc-meeting-minutes-8-18-2022/27050/1 all reactions sorry, something went wrong.  for free to join this conversation on github . already have an account?  to comment reviewers michaelorlov michaelorlov approved these changes jhdcs jhdcs approved these changes emersonknapp awaiting requested review from emersonknapp emersonknapp is a code owner automatically assigned from ros2/tooling-reviewers assignees no one assigned labels none yet projects none yet milestone no milestone development successfully merging this pull request may close these issues. 4 participants add this suggestion to a batch that can be applied as a single commit. this suggestion is invalid because no changes were made to the code. suggestions cannot be applied while the pull request is closed. suggestions cannot be applied while viewing a subset of changes. only one suggestion per line can be applied in a batch. add this suggestion to a batch that can be applied as a single commit. applying suggestions on deleted lines is not supported. you must change the existing code in this line in order to create a valid suggestion. outdated suggestions cannot be applied. this suggestion has been applied or marked resolved. suggestions cannot be applied from pending reviews. suggestions cannot be applied on multi-line comments. suggestions cannot be applied while the pull request is queued to merge. suggestion cannot be applied right now.  check back later. you cant perform that action at this time.