skip to content you signed in with another tab or window. reload to refresh your session. you signed out in another tab or window. reload to refresh your session. you switched accounts on another tab or window. reload to refresh your session. dismiss alert ros2 / rcutils public notifications you must be signed in to change notification settings fork 100 star 56 new issue have a question  this project?  for a free github account to open an issue and  its maintainers and the community.  for github by clicking  for github, you agree to our  of service and  statement . well occasionally send you account related s. already on github?  to your account jump to bottom optimize calls via the rcutils_log macros. #369 merged clalancette merged 2 commits into rolling from clalancette/avoid-double-enabled-for aug 3, 2022 merged optimize calls via the rcutils_log macros. #369 clalancette merged 2 commits into rolling from clalancette/avoid-double-enabled-for aug 3, 2022 conversation copy link contributor clalancette commented jul 29, 2022 it turns out that when we call rcutils_log_debug (and friends), we were calling rcutils_logging_logger_is_enabled_for() twice; once in the macro itself (where we want to avoid evaluating conditions if the logger is disabled), and once in the rcutils_log() call. since rcutils_logging_logger_is_enabled_for() is a pretty expensive function, this means we were doing unnecessary work. improve this by splitting rcutils_log() into rcutils_log() and rcutils_log_internal(), the latter of which does not do the enabled check. then change the macros to call the internal version of the api, which avoids the double check while still maintaining the safety guarantees we want if a user calls rcutils_log() directly. signed-off-by: chris lalancette clalancette@openrobotics.org sorry, something went wrong.  1 fujitatomoya reacted with rocket emoji all reactions  1 reaction optimize calls via the rcutils_log macros.  a5d1072 it turns out that when we call rcutils_log_debug (and friends), we were calling rcutils_logging_logger_is_enabled_for() twice; once in the macro itself (where we want to avoid evaluating conditions if the logger is disabled), and once in the rcutils_log() call. since rcutils_logging_logger_is_enabled_for() is a pretty expensive function, this means we were doing unnecessary work. improve this by splitting rcutils_log() into rcutils_log() and rcutils_log_internal(), the latter of which does not do the enabled check. then change the macros to call the internal version of the api, which avoids the double check while still maintaining the safety guarantees we want if a user calls rcutils_log() directly. signed-off-by: chris lalancette <clalancette@openrobotics.org> copy link contributor author clalancette commented jul 29, 2022  edited loading ci: linux linux-aarch64 windows all reactions sorry, something went wrong. windows fix.  efeee78 signed-off-by: chris lalancette <clalancette@openrobotics.org> copy link collaborator fujitatomoya commented jul 31, 2022 related to #364 all reactions sorry, something went wrong. fujitatomoya approved these changes jul 31, 2022 view reviewed changes copy link collaborator fujitatomoya left a comment there was a problem hiding this comment. choose a reason for hiding this comment the reason will be displayed to describe this comment to others. learn more . choose a reason spam abuse off topic outdated duplicate resolved hide comment lgtm! but adding test would be ideal. sorry, something went wrong. all reactions copy link contributor author clalancette commented aug 1, 2022 lgtm! but adding test would be ideal. i ended up not adding tests because i think everything here is already covered elsewhere. that is, the tests in https://github.com/ros2/rcutils/blob/rolling/test/test_logging.cpp end up testing rcutils_log , and the tests in https://github.com/ros2/rcutils/blob/rolling/test/test_logging_macros.cpp test the logging macros (which indirectly test rcutils_log_internal ). that said, let me know if you still think i should add additional tests.  1 fujitatomoya reacted with thumbs up emoji all reactions  1 reaction sorry, something went wrong. copy link collaborator fujitatomoya commented aug 2, 2022 @clalancette thanks for the comment, i am good to go with green ci. all reactions sorry, something went wrong. copy link contributor author clalancette commented aug 3, 2022 here's another ci try: linux linux-aarch64 windows all reactions sorry, something went wrong. clalancette merged commit f0bee9e into rolling aug 3, 2022 clalancette deleted the clalancette/avoid-double-enabled-for branch august 3, 2022 19:30 clalancette mentioned this pull request oct 12, 2022 added initial version of logging.md file. ros2/design#315 open  for free to join this conversation on github . already have an account?  to comment reviewers fujitatomoya fujitatomoya approved these changes assignees no one assigned labels none yet projects none yet milestone no milestone development successfully merging this pull request may close these issues. 2 participants add this suggestion to a batch that can be applied as a single commit. this suggestion is invalid because no changes were made to the code. suggestions cannot be applied while the pull request is closed. suggestions cannot be applied while viewing a subset of changes. only one suggestion per line can be applied in a batch. add this suggestion to a batch that can be applied as a single commit. applying suggestions on deleted lines is not supported. you must change the existing code in this line in order to create a valid suggestion. outdated suggestions cannot be applied. this suggestion has been applied or marked resolved. suggestions cannot be applied from pending reviews. suggestions cannot be applied on multi-line comments. suggestions cannot be applied while the pull request is queued to merge. suggestion cannot be applied right now.  check back later. you cant perform that action at this time.