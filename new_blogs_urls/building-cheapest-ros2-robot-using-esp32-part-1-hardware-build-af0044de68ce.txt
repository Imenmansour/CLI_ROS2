open in app sign up sign in write sign up sign in building cheapest ros2 robot using esp32  part 1  hardware build robofoundry  follow 12 min read  sep 22, 2023  4 listen share i have always wanted to build a robot that was inexpensive and accessible to many people as an entry level robot to build that was running using ros2. however, several challenges remained in order to accomplish that goal. if you have read any of my previous robot build articles, you would know that the biggest cost for building a ros2 based robot comes from an sbc like raspberry pi or jetson nano and a 360 lidar like rpilidar, both approximately 100 each. all the other parts can be fairly manageable cost if you are able to 3d print some parts or buy off the shelf cheap wheeled robot kit from amazon or aliexpress including base frame, battery, motors with encoders and imu. however, the rpi and lidar were always a bottleneck until recently i was able to run the linorobot2 hardware on esp32 microcontroller using microros framework. this basically opened up the possibility that i had pretty much closed the door on due to cost of rpilidar. this article series is continuation of my efforts to build a small and affordable ros2 robot that anyone can build with widely available parts anywhere in the world and learn and tinker with ros2 concepts. learning robotics finally doesnt have to be very expensive. at the end of the build you will be able to drive the robot around using a joystick. in future, we may even be able to add lidar to do slam based mapping to build the map using a package like slamtoolbox. at the least, you will walk away with a solid knowledge of ros2 and how to build and troubleshoot a robot from scratch that will help you in your future endeavors. in this article we will focus on hardware build of the esp32 ros2 robot that is based on linorobot2 framework. the goal is to build a basic differential drive robot that is able to read encoders and imu sensors and broadcast those messages control motors using a joystick controllers driven by cmdvel topic in the next few articles we will test and calibrate motors and imu and visualize the robot in rviz2 and gazebo. in subsequent articles if everything goes according to plan and thats a big if, we will be able use slam to localize the robot and nav2 to drive robot autonomously to a selected location on the map. bill of materials needed for hardware build of the robot these are not affiliate links: esp32wroom32d or later version of esp32 microcontroller these support microros 3 for 17 approx. 6each 3pcs esp32devkitc core board esp32 development board esp32wroom32d wireless wifi development shop amazon for 3pcs esp32devkitc core board esp32 development board esp32wroom32d wireless wifi development board a.co 2. encoder motors  6v quantity  2 for differential drive robot approx. 7each total of 15 for 2 motors. these dfrobot fit0450 motors come in two variation ishape and lshape. i went with ishape because i already had them from previous project. you can also substitute these with other encoder motors if you have them but if you get higher voltage like 12v, make sure you adjust the power bank or battery to supply necessary voltage and power. fit0450  digikey electronics order today, ships today. fit0450  dc motor gearmotor 160 rpm incremental 6vdc from dfrobot. pricing and availability www.digikey.com 3. power bank battery quantity  1 approx. 1520 iniu portable charger, slimmest 10000mah 5v3a power bank, usb c inout highspeed charging battery shop amazon for iniu portable charger, slimmest 10000mah 5v3a power bank, usb c inout highspeed charging battery a.co my power bank is old poweradd that is no longer sold on amazon so this is just a suggested replacement, you can find any power bank that works for you that has similar specs and output ports. i have not tried this myself. 4. l298n motor controller quantity  1 4 for 12 approx. 3each hiletgo 4pcs l298n motor driver controller board module stepper motor dc dual hbridge for arduino shop amazon for hiletgo 4pcs l298n motor driver controller board module stepper motor dc dual hbridge for arduino a.co 5. mpu6050 or gy521 imu quantity 1  3 for 10 approx 3each hiletgo gy521 mpu6050 mpu6050 3 axis accelerometer gyroscope module 6 dof 6axis accelerometer shop amazon for hiletgo gy521 mpu6050 mpu6050 3 axis accelerometer gyroscope module 6 dof 6axis accelerometer a.co 6.wheeled robot kit  something like this from amazon 13 or this from digikey 8. the digikey one is 4wd so you may have to provide your own castor wheel. i have bunch of these old kits so i was ok to modify the kit a bit. alternatively, you can 3d print the entire base using something like this open robotics platform system, they have library of many freely downloadable parts you can simply download the 3d printing files and print them yourself. of course, your robot will look different than this but the basic principles will still be same. 110090263  digikey electronics order today, ships today. 110090263  raspberry pi phat, grove arduino ide wheeled robotics kit from seeed technology www.digikey.com 7. couple of breadboards and wires 10 huarew breadboard and jumper wires kit include 830 tie points breadboard 400 tie points breadboard buy huarew breadboard and jumper wires kit include 830 tie points breadboard 400 tie points breadboard jumper wire a.co 8. voltage regulator  optional 9. i was originally planning to use this but i have found easier way to power the robot with two separate batteries to avoid brown out for esp32 so im not going to use it. dfr0205  digikey electronics order today, ships today. dfr0205  gs2678  dcdc, step down 1, nonisolated outputs evaluation board from dfrobot www.digikey.com 9. mini usb hub  optional 5. im planning to use two separate batteries  one for motors 6v and second for powering esp32 power bank with microusb connector for esp32. however, you can potentially power everything with single battery, youll have to get a hub like this and plug it into your power bank and then extend usb cables to power motors and esp32 from the hub. 2998  digikey electronics order adafruit industries llc 2998 15281612nd at digikey. check stock and pricing, view product specifications, and www.digikey.com 10. joystick controller optional  i use one of these cheap joystick controllers to control the robot to send cmdvel messages. you can avoid using this and use terminal based tools like teleoptwist or teleopkeyboard or even use a mobile app like dabble for joystick. there are so many options. check out this article for more options. fandragon usb wireless gaming controller gamepad for pclaptop computerwindows xp7810  ps3  1 streamlined appearance, elegant and fashionable, humanized design 2 strong compatibility: support android games a.co in addition, to this you may need a few more things like: additional dupont wires with different combinations maletomale, femaletomale or femaletofemale depending on how you wire it. you may need some double sided tape or 3m pads for installing photo frames to install breadboard on top of the top base plate. this way you can pull out the easy removable tab to uninstall the breadboard later if necessary. few types of usb cables  usba to microusb, usba to usba, usba to bare wires positive and negative. you may need additional standoffs to increase the height between two base plates to make sure you have room to install batteries between the two base plates. you may need some velcro ties like these or silicone ties like these to make sure batteries are held tightly with the base plate. we are doing the wiring purely using breadboard and dupont wires to keep things simple but you can use more perma boards and solder the wires if you are good with soldering. im not great at soldering so i would rather build a pcb and get it printed than solder so many connection points. overall as you can see all these parts add up to approx. 6070. you can also cut the cost further if you just drop the power bank and supply two separate 4xaa battery holders that will supply 6v. that will make it a sub 50 build!!! depending on which base frame wheeled robot kit you decided to go with, this will vary but lets build the first layer of the base plate along with two front wheels and castor wheel in the back. it should look something like this. mine was a 4wd robot kit so im using a castor wheel from another robot i built in past but you can buy that separately or get a kit with everything together. you only need baseframe, two wheels and caster wheels. we will be replacing the cheap tt motors that come with this kit with our own tt motor with encoders so we can get wheel odometry. the wheeled robot kit comes with everything except castor wheel contents of the robot kit front wheels and castor installed on base plate second base plate mounted on top with standoffs. l298 and esp32 on breadboard installed. one of the things i had a little trouble with was while replacing original tt motor that came with kit with the dfrobot fit0450 encoder motor. the problem was the fit0450 has an rounded encoder board protruding out which was not flushing properly with base plate. so i needed holes in the tslots that were supplied with the robot kit to be moved out by 57 mm to accomodate for the rouding protrusion in fit0450. i tried to drill the existing hole to make it longer but broke a few tslots in the process. so i decided to build a cad drawing and 3d printed a part that looks like this 4 copies of it. this solved the problem for me to adjust for the offset in hole location on motor and on the tslots. see the picture below that shows the original tslot that came with the kit and one i had to 3d print to replace it. ill upload an stl file for this in github once i have everything working. left original and right 3dprinted fix wiring diagram main wiring diagram power arrangement and grounding breadboard and other devices wiring table it is important to note how the pin numbers are counted  esp32 reference doc . this version of esp32 board im using is esp32wroom32d devkit and it has 19 pins on each side so total 38 pins. as shown in diagram above, while you are holding the usb port of esp32 at bottom, the right side jumper row of pins is labeled j3 and left side jumper is labled j2. for each jumper we count the pin numbers starting at 1 from top to bottom. so for j2 and j3 the top pins are 1 and bottom pins are 19. now that you have proper orientation of pinout, you can start wiring the pins one by one as described in table below. from esp32  other devices in addition to this you need provide power to l298n motor driver, two motors, two encoders one for each motor and mpu6050. here is the general power plan power for l298n connect positive and negative of main battery to l298 power in screw terminals. this is the 3point screw terminal shown in blue at left bottom in diagram above. make sure the 5v output jumper is installed as shown in diagram. when this jumper is installed, the 5v output terminal will act as a voltage regulator supplying 5v output which we can use for powering encoders. the first pin out of the 3pins closest to the corner of the l298n board is input power to l298n, this can be up to 12v. however, in out case we will be supplying 6v since our dfrobot tt motors are 67.5v max rating and we dont want to exceed that. the pin in the middle is common gnd for input and output voltages. we will be using this for gnd to connect with our breadboard ve line. and the third pin furthest from corner is 5v output. this 5v out we will use for powering the motor encoders. so we will connect the 5v output screw terminal to breadboard ve line. power for motor and encoders the dfrobot fit0450 motors have total 6 wires coming out. the two pair is for power and 4pair wire is for encoder. see fit0450 product wiki for more details. the main power for motor will be supplied by connecting the two pair wire redblack to one of the two output screw terminals as shown in diagram above. these are 2point screw terminals on the sides marked m1 and m2 in diagram above. you can initially connect the red and black wire in interchangeable fashion to the l298n screw terminal, it will not hurt the motor as long as voltage is 67.5v. the only thing that can happen is motor will rotate in opposite direction to what you desire. this we can correct during testing phase. the encoders have total 4 wires, two signal wires  one for channel a and one for channel b. and two more wires positive and gnd to supply power to encoder. the channel a and b wires will be connected to esp32 pins as described in the diagram and wiring table above. however, for positive and gnd wires for encoder, simply connect them to breadboard positive and negativegnd lines as shown in second power arrangement diagram above with breadboard. power for mpu6050 imu sensor the mpu6050 needs 3.3v power which we can supply using esp32 j2 pin 1 and another gnd pin from esp32. the scl and sda signal pins from mpu6050 will be connected to esp32 as described in the diagram and wiring table above. when mouting the mpu6050 board on the breadboard, make sure that you are aligning the x arrow to point to front of robot, y should be pointing to right of the robot. see the diagrams in original linorobot2hardware readme file. https:raw.githubusercontent.comrobofoundrylinorobot2hardwarehippoesp32fixmasterdocsimuconnection.png alternate power arrangement with single battery the default power arrangement assumes that we are going to use two separate batteries to power motor and esp32. however, if you want to supply power with a single battery, you will need an arrangement that looks something like this. i have not used this because i didnt want to risk brown out of the esp32 if motors consume too much power. the usb to bare wire cable essentially splits the usb cable into two positive and negative wires and looks something like this: elnone 2pack 1m3.3ft 20awg usb 2.0 male plug 2pin wire diy pigtail cable 5v 5a black usb power buy elnone 2pack 1m3.3ft 20awg usb 2.0 male plug 2pin wire diy pigtail cable 5v 5a black usb power with 2position a.co the final assembled robot looks something like this: thats pretty much it for the mechanical and hardware build of the robot. in the next article we will work on uploading the software into esp32 and running all sorts of tests on the robot to make sure motors, encoders and imu sensors are working well and publishing the data on ros2 topics. in addition we will be setting up linorobot2 on host computer your laptop or desktop. references : running linorobot2hardware on esp32wroom32d using wifi recently, i wrote an article that described how to get some of the microros examples running on esp32wroom32d board robofoundry.medium.com making a mobile robot 5  power concepts in this tutorial were going to look at all things power, and hopefully cover everything youd want to know about articulatedrobotics.xyz github  robofoundrylinorobot2hardwarehippoesp32fix: a fork of linorobot2hardware with a fork of linorobot2hardware with support of esp32 on ros2 humble and other devices  github  github.com microdcmotorwithencodersj01skufit0450dfrobot wiki:tt motor with encoder is a motor with a 120:1 gearbox and an integrated quadrature encoder that provides a wiki.dfrobot.com esp32devkitc v4 getting started guide  esp32   espidf programming guide latest documentation esp32devkitc v4 is a smallsized esp32based development board produced by espressif. most of the io pins are broken docs.espressif.com making a mobile robot 14a  teleoperation what is teleop? articulatedrobotics.xyz ros2 robotics micro ros esp32 robots follow written by robofoundry 331 followers follow help status about careers press blog privacy terms text to speech teams