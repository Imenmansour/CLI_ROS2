tutorials advanced simulators webots setting up a reset handler edit on github setting up a reset handler ï goal: extend a robot simulation with a reset handler to restart nodes when the reset button of webots is pressed. tutorial level: advanced time: 10 minutes background ï in this tutorial, you will learn how to implement a reset handler in a robot simulation using webots. the webots reset button reverts the world to the initial state and restarts controllers. it is convenient as it quickly resets the simulation, but in the context of ros 2, robot controllers are not started again making the simulation stop. the reset handler allows you to restart specific nodes or perform additional actions when the reset button in webots is pressed. this can be useful for scenarios where you need to reset the state of your simulation or restart specific components without completely restarting the complete ros system. prerequisites ï before proceeding with this tutorial, make sure you have completed the following: understanding of ros 2 nodes and topics covered in the beginner tutorials . knowledge of webots and ros 2 and its interface package. familiarity with setting up a robot simulation (basic) . reset handler for simple cases (controllers only) ï in the launch file of your package, add the respawn parameter. def generate_launch_description (): robot_driver = webotscontroller ( robot_name = 'my_robot' , parameters = [ { 'robot_description' : robot_description_path } ], # every time one resets the simulation the controller is automatically respawned respawn = true ) # starts webots webots = webotslauncher ( world = pathjoinsubstitution ([ package_dir , 'worlds' , world ])) return launchdescription ([ webots , robot_driver ]) on reset, webots kills all driver nodes. therefore, to start them again after reset, you should set the respawn property of the driver node to true . it will ensure driver nodes are up and running after the reset. reset handler for multiple nodes (no shutdown required) ï if you have some other nodes that have to be started along with the driver node (e.g. ros2_control nodes), then you can use the onprocessexit event handler: def get_ros2_control_spawners ( * args ): # declare here all nodes that must be restarted at simulation reset ros_control_node = node ( package = 'controller_manager' , executable = 'spawner' , arguments = [ 'diffdrive_controller' ] ) return [ ros_control_node ] def generate_launch_description (): robot_driver = webotscontroller ( robot_name = 'my_robot' , parameters = [ { 'robot_description' : robot_description_path } ], # every time one resets the simulation the controller is automatically respawned respawn = true ) # starts webots webots = webotslauncher ( world = pathjoinsubstitution ([ package_dir , 'worlds' , world ])) # declare the reset handler that respawns nodes when robot_driver exits reset_handler = launch . actions . registereventhandler ( event_handler = launch . event_handlers . onprocessexit ( target_action = robot_driver , on_exit = get_ros2_control_spawners , ) ) return launchdescription ([ webots , robot_driver , reset_handler ] + get_ros2_control_spawners ()) it is not possible to use the respawn property on the ros2_control node, as the spawner exits during launch time and not when the simulation is reset. instead we should declare a list of nodes in a function (e.g. get_ros2_control_spawners ). the nodes of this list are started along other nodes when executing the launch file. with the reset_handler , the function is also declared as action to start when the robot_driver node exits, which corresponds to the moment when the simulation is reset in the webots interface. the robot_driver node still has the respawn property set to true , so that it gets restarted along with ros2_control nodes. reset handler requiring node shutdown ï with the current ros 2 launch api, there is no way to make the reset work in launch files where nodes need to be shutdown before the restart (e.g. nav2 or rviz ). the reason is that currently, ros 2 doesnât allow to shutdown specific nodes from a launch file. there is a solution, but it requires to manually restart nodes after pushing the reset button. webots needs to be started in a specific launch file without other nodes. def generate_launch_description (): # starts webots webots = webotslauncher ( world = pathjoinsubstitution ([ package_dir , 'worlds' , world ])) return launchdescription ([ webots ]) a second launch file must be started from another process. this launch file contains all other nodes, including robot controllers/plugins, navigation2 nodes, rviz, state publishers, etc. def generate_launch_description (): robot_driver = webotscontroller ( robot_name = 'my_robot' , parameters = [ { 'robot_description' : robot_description_path } ] ) ros_control_node = node ( package = 'controller_manager' , executable = 'spawner' , arguments = [ 'diffdrive_controller' ] ) nav2_node = includelaunchdescription ( pythonlaunchdescriptionsource ( os . path . join ( get_package_share_directory ( 'nav2_bringup' ), 'launch' , 'bringup_launch.py' )), launch_arguments = [ ( 'map' , nav2_map ), ( 'params_file' , nav2_params ), ], ) rviz = node ( package = 'rviz2' , executable = 'rviz2' , output = 'screen' ) # declare the handler that shuts all nodes down when robot_driver exits shutdown_handler = launch . actions . registereventhandler ( event_handler = launch . event_handlers . onprocessexit ( target_action = robot_driver , on_exit = [ launch . actions . emitevent ( event = launch . events . shutdown ())], ) ) return launchdescription ([ robot_driver , ros_control_node , nav2_node , rviz , shutdown_handler ]) the second launch file contains a handler that triggers a shutdown event when the driver node exits (which is the case when the simulation is reset). this second launch file must be manually restarted from the command line after pressing the reset button. summary ï in this tutorial, you learned how to implement a reset handler in a robot simulation using webots. the reset handler allows you to restart specific nodes or perform additional actions when the reset button in webots is pressed. you explored different approaches based on the complexity of your simulation and the requirements of your nodes. other versions v: jazzy releases jazzy (latest) iron humble galactic (eol) foxy (eol) eloquent (eol) dashing (eol) crystal (eol) in development rolling