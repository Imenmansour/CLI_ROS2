tutorials intermediate tf2 using time (c++) edit on github using time (c++) ï goal: learn how to get a transform at a specific time and wait for a transform to be available on the tf2 tree using lookuptransform() function. tutorial level: intermediate time: 10 minutes background ï in previous tutorials, we recreated the turtle demo by writing a tf2 broadcaster and a tf2 listener . we also learned how to add a new frame to the transformation tree and learned how tf2 keeps track of a tree of coordinate frames. this tree changes over time, and tf2 stores a time snapshot for every transform (for up to 10 seconds by default). until now we used the lookuptransform() function to get access to the latest available transforms in that tf2 tree, without knowing at what time that transform was recorded. this tutorial will teach you how to get a transform at a specific time. tasks ï 1 update the listener node ï letâs go back to where we ended in the adding a frame tutorial . go to the learning_tf2_cpp package. open turtle_tf2_listener.cpp and take a look at the lookuptransform() call: try { t = tf_buffer_ -> lookuptransform ( toframerel , fromframerel , tf2 :: timepointzero ); } catch ( const tf2 :: transformexception & ex ) { you can see that we specified a time equal to 0 by calling tf2::timepointzero . note the tf2 package has itâs own time type tf2::timepoint , which is different from rclcpp::time . many apis in the package tf2_ros automatically convert between rclcpp::time and tf2::timepoint . rclcpp::time(0, 0, this->get_clock()->get_clock_type()) could have been used here, but it would have been converted to tf2::timepointzero anyways. for tf2, time 0 means âthe latest availableâ transform in the buffer. now, change this line to get the transform at the current time, this->get_clock()->now() : rclcpp :: time now = this -> get_clock () -> now (); try { t = tf_buffer_ -> lookuptransform ( toframerel , fromframerel , now ); } catch ( const tf2 :: transformexception & ex ) { now build the package and try to run the launch file. ros2 launch learning_tf2_cpp turtle_tf2_demo_launch.py you will notice that it fails and outputs something similar to this: [info] [1629873136.345688064] [listener]: could not transform turtle2 to turtle1: lookup would require extrapolation into the future. requested time 1629873136.345539 but the latest data is at time 1629873136.338804, when looking up transform from frame [turtle1] to frame [turtle2] it tells you that the frame does not exist or that the data is in the future. to understand why is this happening we need to understand how buffers work. firstly, each listener has a buffer where it stores all the coordinate transforms coming from the different tf2 broadcasters. secondly, when a broadcaster sends out a transform, it takes some time before that transform gets into the buffer (usually a couple of milliseconds). as a result, when you request a frame transform at time ânowâ, you should wait a few milliseconds for that information to arrive. 2 fix the listener node ï tf2 provides a nice tool that will wait until a transform becomes available. you use this by adding a timeout parameter to lookuptransform() . to fix this, edit your code as shown below (add the last timeout parameter): rclcpp :: time now = this -> get_clock () -> now (); try { t = tf_buffer_ -> lookuptransform ( toframerel , fromframerel , now , 50 ms ); } catch ( const tf2 :: transformexception & ex ) { the lookuptransform() can take four arguments, where the last one is an optional timeout. it will block for up to that duration waiting for it to timeout. 3 check the results ï you can now build the package and run the launch file. ros2 launch learning_tf2_cpp turtle_tf2_demo_launch.py you should notice that lookuptransform() will actually block until the transform between the two turtles becomes available (this will usually take a few milliseconds). once the timeout has been reached (fifty milliseconds in this case), an exception will be raised only if the transform is still not available. summary ï in this tutorial, you learned how to acquire a transform at a specific timestamp and how to wait for a transform to be available on the tf2 tree when using the lookuptransform() function. other versions v: jazzy releases jazzy (latest) iron humble galactic (eol) foxy (eol) eloquent (eol) dashing (eol) crystal (eol) in development rolling