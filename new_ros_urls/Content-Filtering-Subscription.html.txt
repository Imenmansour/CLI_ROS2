tutorials demos creating a content filtering  edit on github creating a content filtering  ï goal: create a content filtering . tutorial level: advanced time: 15 minutes overview ï ros 2 applications typically consist of topics to transmit data from publishers to s. basically, s receive all published data from publishers on the topic. but sometimes, a  might be interested in only a subset of the data which is being sent by publishers. a content filtering  allows to receive only the data of interest for the application. in this demo, weâll be highlighting how to create a content filtering  and how they work. rmw support ï content filtering s require rmw implementation support. content-filtering- support status ï rmw_fastrtps supported rmw_connextdds supported rmw_cyclonedds not supported currently all rmw implementations that support content filtering s are dds based. that means that the supported filtering expressions and parameters are also dependent on dds , you can refer to dds specification annex b - syntax for queries and filters for details. installing the demo ï see the installation instructions for details on installing ros 2. if youâve installed ros 2 from packages, ensure that you have ros-jazzy-demo-nodes-cpp installed. if you downloaded the archive or built ros 2 from source, it will already be part of the installation. temperature filtering demo ï this demo shows how a content filtering  can be used to only receive temperature values that are out of the acceptable temperature range, detecting emergencies. the content filtering  filters out the uninteresting temperature data, so that the  callback is not issued. contentfilteringpublisher: https://github.com/ros2/demos/blob/jazzy/demo_nodes_cpp/src/topics/content_filtering_publisher.cpp #include <chrono> #include <cstdio> #include <memory> #include <utility> #include "rclcpp/rclcpp.hpp" #include "rclcpp_components/register_node_macro.hpp" #include "std_msgs/msg/float32.hpp" #include "demo_nodes_cpp/visibility_control.h" using namespace std :: chrono_literals ; namespace demo_nodes_cpp { // the simulated temperature data starts from -100.0 and ends at 150.0 with a step size of 10.0 constexpr std :: array < float , 3 > temperature_setting { -100.0f , 150.0f , 10.0f }; // create a contentfilteringpublisher class that subclasses the generic rclcpp::node base class. // the main function below will instantiate the class as a ros node. class contentfilteringpublisher : public rclcpp :: node { public : demo_nodes_cpp_public explicit contentfilteringpublisher ( const rclcpp :: nodeoptions & options ) : node ( "content_filtering_publisher" , options ) { // create a function for when messages are to be sent. setvbuf ( stdout , null , _ionbf , bufsiz ); auto publish_message = [ this ]() -> void { msg_ = std :: make_unique < std_msgs :: msg :: float32 > (); msg_ -> data = temperature_ ; temperature_ += temperature_setting [ 2 ]; if ( temperature_ > temperature_setting [ 1 ]) { temperature_ = temperature_setting [ 0 ]; } rclcpp_info ( this -> get_logger (), "publishing: '%f'" , msg_ -> data ); // put the message into a queue to be processed by the middleware. // this call is non-blocking. pub_ -> publish ( std :: move ( msg_ )); }; // create a publisher with a custom quality of service profile. // uniform initialization is suggested so it can be trivially changed to // rclcpp::keepall{} if the user wishes. // (rclcpp::keeplast(7) -> rclcpp::keepall() fails to compile) rclcpp :: qos qos ( rclcpp :: keeplast { 7 }); pub_ = this -> create_publisher < std_msgs :: msg :: float32 > ( "temperature" , qos ); // use a timer to schedule periodic message publishing. timer_ = this -> create_wall_timer ( 1 s , publish_message ); } private : float temperature_ = temperature_setting [ 0 ]; std :: unique_ptr < std_msgs :: msg :: float32 > msg_ ; rclcpp :: publisher < std_msgs :: msg :: float32 >:: sharedptr pub_ ; rclcpp :: timerbase :: sharedptr timer_ ; }; } // namespace demo_nodes_cpp the content filter is defined in the  side, publishers donât need to be configured in any special way to allow content filtering. the contentfilteringpublisher node publishes simulated temperature data starting from -100.0 and ending at 150.0 with a step size of 10.0 every second. we can run the demo by running the ros2 run demo_nodes_cpp content_filtering_publisher executable (donât forget to source the setup file first):  ros2 run demo_nodes_cpp content_filtering_publisher [ info ] [ 1651094594 .822753479 ] [ content_filtering_publisher ] : publishing: '-100.000000' [ info ] [ 1651094595 .822723857 ] [ content_filtering_publisher ] : publishing: '-90.000000' [ info ] [ 1651094596 .822752996 ] [ content_filtering_publisher ] : publishing: '-80.000000' [ info ] [ 1651094597 .822752475 ] [ content_filtering_publisher ] : publishing: '-70.000000' [ info ] [ 1651094598 .822721485 ] [ content_filtering_publisher ] : publishing: '-60.000000' [ info ] [ 1651094599 .822696188 ] [ content_filtering_publisher ] : publishing: '-50.000000' [ info ] [ 1651094600 .822699217 ] [ content_filtering_publisher ] : publishing: '-40.000000' [ info ] [ 1651094601 .822744113 ] [ content_filtering_publisher ] : publishing: '-30.000000' [ info ] [ 1651094602 .822694805 ] [ content_filtering_publisher ] : publishing: '-20.000000' [ info ] [ 1651094603 .822735805 ] [ content_filtering_publisher ] : publishing: '-10.000000' [ info ] [ 1651094604 .822722094 ] [ content_filtering_publisher ] : publishing: '0.000000' [ info ] [ 1651094605 .822699960 ] [ content_filtering_publisher ] : publishing: '10.000000' [ info ] [ 1651094606 .822748946 ] [ content_filtering_publisher ] : publishing: '20.000000' [ info ] [ 1651094607 .822694017 ] [ content_filtering_publisher ] : publishing: '30.000000' [ info ] [ 1651094608 .822708798 ] [ content_filtering_publisher ] : publishing: '40.000000' [ info ] [ 1651094609 .822692417 ] [ content_filtering_publisher ] : publishing: '50.000000' [ info ] [ 1651094610 .822696426 ] [ content_filtering_publisher ] : publishing: '60.000000' [ info ] [ 1651094611 .822751913 ] [ content_filtering_publisher ] : publishing: '70.000000' [ info ] [ 1651094612 .822692231 ] [ content_filtering_publisher ] : publishing: '80.000000' [ info ] [ 1651094613 .822745549 ] [ content_filtering_publisher ] : publishing: '90.000000' [ info ] [ 1651094614 .822701982 ] [ content_filtering_publisher ] : publishing: '100.000000' [ info ] [ 1651094615 .822691465 ] [ content_filtering_publisher ] : publishing: '110.000000' [ info ] [ 1651094616 .822649070 ] [ content_filtering_publisher ] : publishing: '120.000000' [ info ] [ 1651094617 .822693616 ] [ content_filtering_publisher ] : publishing: '130.000000' [ info ] [ 1651094618 .822691832 ] [ content_filtering_publisher ] : publishing: '140.000000' [ info ] [ 1651094619 .822688452 ] [ content_filtering_publisher ] : publishing: '150.000000' [ info ] [ 1651094620 .822645327 ] [ content_filtering_publisher ] : publishing: '-100.000000' [ info ] [ 1651094621 .822689219 ] [ content_filtering_publisher ] : publishing: '-90.000000' [ info ] [ 1651094622 .822694292 ] [ content_filtering_publisher ] : publishing: '-80.000000' [ ... ] contentfilteringsubscriber: https://github.com/ros2/demos/blob/jazzy/demo_nodes_cpp/src/topics/content_filtering_subscriber.cpp #include "rclcpp/rclcpp.hpp" #include "rclcpp_components/register_node_macro.hpp" #include "rcpputils/join.hpp" #include "std_msgs/msg/float32.hpp" #include "demo_nodes_cpp/visibility_control.h" namespace demo_nodes_cpp { // emergency temperature data less than -30 or greater than 100 constexpr std :: array < float , 2 > emergency_temperature { -30.0f , 100.0f }; // create a contentfilteringsubscriber class that subclasses the generic rclcpp::node base class. // the main function below will instantiate the class as a ros node. class contentfilteringsubscriber : public rclcpp :: node { public : demo_nodes_cpp_public explicit contentfilteringsubscriber ( const rclcpp :: nodeoptions & options ) : node ( "content_filtering_subscriber" , options ) { setvbuf ( stdout , null , _ionbf , bufsiz ); // create a callback function for when messages are received. auto callback = [ this ]( const std_msgs :: msg :: float32 & msg ) -> void { if ( msg . data < emergency_temperature [ 0 ] || msg . data > emergency_temperature [ 1 ]) { rclcpp_info ( this -> get_logger (), "i receive an emergency temperature data: [%f]" , msg . data ); } else { rclcpp_info ( this -> get_logger (), "i receive a temperature data: [%f]" , msg . data ); } }; // initialize a  with a content filter to receive emergency temperature data that // are less than -30 or greater than 100. rclcpp :: options sub_options ; sub_options . content_filter_options . filter_expression = "data < %0 or data > %1" ; sub_options . content_filter_options . expression_parameters = { std :: to_string ( emergency_temperature [ 0 ]), std :: to_string ( emergency_temperature [ 1 ]) }; sub_ = create_ < std_msgs :: msg :: float32 > ( "temperature" , 10 , callback , sub_options ); if ( ! sub_ -> is_cft_enabled ()) { rclcpp_warn ( this -> get_logger (), "content filter is not enabled since it's not supported" ); } else { rclcpp_info ( this -> get_logger (), "subscribed to topic \" %s \" with content filter options \" %s, {%s} \" " , sub_ -> get_topic_name (), sub_options . content_filter_options . filter_expression . c_str (), rcpputils :: join ( sub_options . content_filter_options . expression_parameters , ", " ). c_str ()); } } private : rclcpp ::  < std_msgs :: msg :: float32 >:: sharedptr sub_ ; }; } // namespace demo_nodes_cpp to enable content filtering, applications can set the filtering expression and the expression parameters in options . the application can also check if content filtering is enabled on the . in this demo, the contentfilteringsubscriber node creates a content filtering  that receives a message only if the temperature value is less than -30.0 or greater than 100.0. as commented before, content filtering  support depends on the rmw implementation. applications can use the is_cft_enabled method to check if content filtering is actually enabled on the . to test content filtering , letâs run it:  ros2 run demo_nodes_cpp content_filtering_subscriber [ info ] [ 1651094590 .682660703 ] [ content_filtering_subscriber ] : subscribed to topic "/temperature" with content filter options "data < %0 or data > %1, {-30.000000, 100.000000}" [ info ] [ 1651094594 .823805294 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -100.000000 ] [ info ] [ 1651094595 .823419993 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -90.000000 ] [ info ] [ 1651094596 .823410859 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -80.000000 ] [ info ] [ 1651094597 .823350377 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -70.000000 ] [ info ] [ 1651094598 .823282657 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -60.000000 ] [ info ] [ 1651094599 .823297857 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -50.000000 ] [ info ] [ 1651094600 .823355597 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -40.000000 ] [ info ] [ 1651094615 .823315377 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ 110 .000000 ] [ info ] [ 1651094616 .823258458 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ 120 .000000 ] [ info ] [ 1651094617 .823323525 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ 130 .000000 ] [ info ] [ 1651094618 .823315527 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ 140 .000000 ] [ info ] [ 1651094619 .823331424 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ 150 .000000 ] [ info ] [ 1651094620 .823271748 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -100.000000 ] [ info ] [ 1651094621 .823343550 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -90.000000 ] [ info ] [ 1651094622 .823286326 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -80.000000 ] [ info ] [ 1651094623 .823371031 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -70.000000 ] [ info ] [ 1651094624 .823333112 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -60.000000 ] [ info ] [ 1651094625 .823266469 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -50.000000 ] [ info ] [ 1651094626 .823284093 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -40.000000 ] you should see a message showing the content filtering options used and logs for each message received only if the temperature value is less than -30.0 or greater than 100.0. if content filtering is not supported by the rmw implementation, the  will still be created without content filtering enabled. we can try that by executing rmw_implementation=rmw_cyclonedds_cpp ros2 run demo_nodes_cpp content_filtering_publisher .  rmw_implementation = rmw_cyclonedds_cpp ros2 run demo_nodes_cpp content_filtering_subscriber [ warn ] [ 1651096637 .893842072 ] [ content_filtering_subscriber ] : content filter is not enabled since it is not supported [ info ] [ 1651096641 .246043703 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -100.000000 ] [ info ] [ 1651096642 .245833527 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -90.000000 ] [ info ] [ 1651096643 .245743471 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -80.000000 ] [ info ] [ 1651096644 .245833932 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -70.000000 ] [ info ] [ 1651096645 .245916679 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -60.000000 ] [ info ] [ 1651096646 .245861895 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -50.000000 ] [ info ] [ 1651096647 .245946352 ] [ content_filtering_subscriber ] : i receive an emergency temperature data: [ -40.000000 ] [ info ] [ 1651096648 .245934569 ] [ content_filtering_subscriber ] : i receive a temperature data: [ -30.000000 ] [ info ] [ 1651096649 .245877906 ] [ content_filtering_subscriber ] : i receive a temperature data: [ -20.000000 ] [ info ] [ 1651096650 .245939068 ] [ content_filtering_subscriber ] : i receive a temperature data: [ -10.000000 ] [ info ] [ 1651096651 .245911450 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 0 .000000 ] [ info ] [ 1651096652 .245879830 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 10 .000000 ] [ info ] [ 1651096653 .245858329 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 20 .000000 ] [ info ] [ 1651096654 .245916370 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 30 .000000 ] [ info ] [ 1651096655 .245933741 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 40 .000000 ] [ info ] [ 1651096656 .245833975 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 50 .000000 ] [ info ] [ 1651096657 .245971483 ] [ content_filtering_subscriber ] : i receive a temperature data: [ 60 .000000 ] you can see the message content filter is not enabled because underlying rmw implementation does not support the feature, but the demo still successfully creates the normal  to receive all temperature data. related content ï content filtering examples that covers all interfaces for content filtering . content filtering design pr other versions v: jazzy releases jazzy (latest) iron humble galactic (eol) foxy (eol) eloquent (eol) dashing (eol) crystal (eol) in development rolling